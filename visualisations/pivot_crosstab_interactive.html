<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Pivot Tables & Cross-Tabulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .explanation {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .explanation h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .visual-flow {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin: 30px 0;
        }

        .flow-arrow {
            font-size: 3em;
            color: #667eea;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            font-size: 14px;
        }

        th, td {
            padding: 12px;
            text-align: center;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        .index-cell {
            background: #e3f2fd;
            font-weight: 600;
            color: #1565c0;
        }

        .data-cell {
            background: white;
            cursor: pointer;
        }

        .data-cell:hover {
            background: #fff9c4;
            transform: scale(1.05);
        }

        .highlight-cell {
            background: #c8e6c9 !important;
            font-weight: 700;
        }

        .margin-cell {
            background: #ffe0b2 !important;
            font-weight: 700;
            border: 2px solid #ff9800 !important;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 25px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(245, 87, 108, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(79, 172, 254, 0.4);
        }

        .output-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 5px solid #28a745;
        }

        .output-box h4 {
            color: #28a745;
            margin-bottom: 10px;
        }

        .output-box pre {
            background: white;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            border: 1px solid #dee2e6;
            line-height: 1.6;
        }

        .code-example {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .code-example .keyword {
            color: #c678dd;
        }

        .code-example .string {
            color: #98c379;
        }

        .code-example .number {
            color: #d19a66;
        }

        .code-example .comment {
            color: #5c6370;
            font-style: italic;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            transition: transform 0.3s ease;
        }

        .comparison-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .comparison-box h3 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .interactive-selector {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }

        .selector-group {
            margin: 15px 0;
        }

        .selector-group label {
            display: block;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
        }

        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid #333;
        }

        .info-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin: 5px;
        }

        .transformation-demo {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .animate-pulse {
            animation: pulse 1s ease-in-out;
        }

        .small-table {
            font-size: 12px;
        }

        .small-table th,
        .small-table td {
            padding: 8px;
        }

        .aggregation-visual {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .agg-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .agg-arrow {
            font-size: 2em;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Interactive Pivot Tables & Cross-Tabulation</h1>
        <p class="subtitle">Master data summarization and reshaping with visual examples</p>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('concept')">üí° Concept</button>
            <button class="tab" onclick="switchTab('builder')">üî® Pivot Builder</button>
            <button class="tab" onclick="switchTab('aggregation')">üìà Aggregation</button>
            <button class="tab" onclick="switchTab('crosstab')">‚úñÔ∏è Cross-Tabulation</button>
        </div>

        <!-- Tab 1: Concept -->
        <div id="concept" class="tab-content active">
            <div class="explanation">
                <h3>üí° What is a Pivot Table?</h3>
                <p>
                    A <strong>pivot table</strong> is a data summarization tool that allows you to reorganize and aggregate data.
                    It transforms rows into columns, columns into rows, and applies aggregation functions to summarize data.
                    Think of it as a powerful way to answer questions like "What's the average by category?" or "What's the total by group?"
                </p>
            </div>

            <div class="visual-flow">
                <div class="transformation-demo">
                    <h4 style="text-align: center; color: #667eea; margin-bottom: 15px;">
                        Original Data (Long Format)
                    </h4>
                    <table class="small-table">
                        <thead>
                            <tr>
                                <th>Day</th>
                                <th>Time</th>
                                <th>Smoker</th>
                                <th>Bill</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="index-cell">Fri</td>
                                <td class="index-cell">Dinner</td>
                                <td class="index-cell">No</td>
                                <td>25.50</td>
                            </tr>
                            <tr>
                                <td class="index-cell">Fri</td>
                                <td class="index-cell">Dinner</td>
                                <td class="index-cell">Yes</td>
                                <td>30.00</td>
                            </tr>
                            <tr>
                                <td class="index-cell">Sat</td>
                                <td class="index-cell">Lunch</td>
                                <td class="index-cell">No</td>
                                <td>15.75</td>
                            </tr>
                            <tr>
                                <td class="index-cell">Sat</td>
                                <td class="index-cell">Lunch</td>
                                <td class="index-cell">Yes</td>
                                <td>18.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="flow-arrow">‚û°Ô∏è</div>

                <div class="transformation-demo">
                    <h4 style="text-align: center; color: #667eea; margin-bottom: 15px;">
                        Pivoted Data (Summary)
                    </h4>
                    <table class="small-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th colspan="2">Smoker</th>
                            </tr>
                            <tr>
                                <th>Day</th>
                                <th>No</th>
                                <th>Yes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="index-cell">Fri</td>
                                <td class="highlight-cell">25.50</td>
                                <td class="highlight-cell">30.00</td>
                            </tr>
                            <tr>
                                <td class="index-cell">Sat</td>
                                <td class="highlight-cell">15.75</td>
                                <td class="highlight-cell">18.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="code-example">
<span class="comment"># Create a pivot table</span>
df.<span class="keyword">pivot_table</span>(
    index=<span class="string">'Day'</span>,        <span class="comment"># Rows</span>
    columns=<span class="string">'Smoker'</span>,   <span class="comment"># Columns</span>
    values=<span class="string">'Bill'</span>,      <span class="comment"># Values to aggregate</span>
    aggfunc=<span class="string">'mean'</span>      <span class="comment"># Aggregation function (default)</span>
)
            </div>

            <div class="explanation">
                <h3>üîë Key Components</h3>
            </div>

            <div class="comparison-grid">
                <div class="comparison-box">
                    <h4 style="color: #667eea;">üìç Index (Rows)</h4>
                    <p style="margin: 15px 0;">
                        The column(s) to use as row labels. Can be single or multiple columns.
                    </p>
                    <div class="info-badge">Groups data vertically</div>
                </div>

                <div class="comparison-box">
                    <h4 style="color: #667eea;">üìä Columns</h4>
                    <p style="margin: 15px 0;">
                        The column(s) to use as column labels. Values become column headers.
                    </p>
                    <div class="info-badge">Groups data horizontally</div>
                </div>

                <div class="comparison-box">
                    <h4 style="color: #667eea;">üí∞ Values</h4>
                    <p style="margin: 15px 0;">
                        The column(s) to aggregate. These are the actual data values to summarize.
                    </p>
                    <div class="info-badge">Data to be aggregated</div>
                </div>

                <div class="comparison-box">
                    <h4 style="color: #667eea;">üî¢ Aggfunc</h4>
                    <p style="margin: 15px 0;">
                        The aggregation function to apply (mean, sum, count, min, max, etc.).
                    </p>
                    <div class="info-badge">How to summarize</div>
                </div>
            </div>

            <div class="output-box">
                <h4>üí° Why Use Pivot Tables?</h4>
                <ul style="line-height: 2; margin-left: 20px;">
                    <li>‚úÖ <strong>Summarize large datasets</strong> - Reduce thousands of rows to meaningful summaries</li>
                    <li>‚úÖ <strong>Compare groups</strong> - See patterns across categories side by side</li>
                    <li>‚úÖ <strong>Calculate statistics</strong> - Compute means, sums, counts, etc. by group</li>
                    <li>‚úÖ <strong>Reshape data</strong> - Transform between long and wide formats</li>
                    <li>‚úÖ <strong>Create reports</strong> - Generate business intelligence summaries</li>
                </ul>
            </div>
        </div>

        <!-- Tab 2: Pivot Builder -->
        <div id="builder" class="tab-content">
            <div class="explanation">
                <h3>üî® Interactive Pivot Table Builder</h3>
                <p>
                    Use the controls below to build your own pivot table and see how different configurations affect the output.
                    We're using a restaurant tips dataset with columns: Day, Time, Smoker, Size, and Bill.
                </p>
            </div>

            <div class="interactive-selector">
                <h4 style="color: #667eea; margin-bottom: 20px; text-align: center;">
                    Configure Your Pivot Table
                </h4>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px;">
                    <div class="selector-group">
                        <label>üìç Index (Rows)</label>
                        <select id="indexSelect" onchange="updatePivotTable()">
                            <option value="Day">Day</option>
                            <option value="Time">Time</option>
                            <option value="Smoker">Smoker</option>
                        </select>
                    </div>

                    <div class="selector-group">
                        <label>üìä Columns</label>
                        <select id="columnsSelect" onchange="updatePivotTable()">
                            <option value="Smoker">Smoker</option>
                            <option value="Time">Time</option>
                            <option value="Day">Day</option>
                        </select>
                    </div>

                    <div class="selector-group">
                        <label>üí∞ Values</label>
                        <select id="valuesSelect" onchange="updatePivotTable()">
                            <option value="Bill">Bill</option>
                            <option value="Size">Size</option>
                        </select>
                    </div>

                    <div class="selector-group">
                        <label>üî¢ Aggregation</label>
                        <select id="aggfuncSelect" onchange="updatePivotTable()">
                            <option value="mean">Mean (Average)</option>
                            <option value="sum">Sum</option>
                            <option value="count">Count</option>
                            <option value="min">Min</option>
                            <option value="max">Max</option>
                        </select>
                    </div>
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <label style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <input type="checkbox" id="marginsCheck" onchange="updatePivotTable()">
                        <span style="font-weight: 600; color: #667eea;">Add Margins (Totals)</span>
                    </label>
                </div>
            </div>

            <div id="pivotTableContainer" style="overflow-x: auto; margin: 20px 0;">
                <!-- Pivot table will be inserted here -->
            </div>

            <div class="output-box" id="builderOutput">
                <h4>üìä Generated Code:</h4>
                <pre id="builderCode">Select options above to generate pivot table...</pre>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #e3f2fd;"></div>
                    <span><strong>Index Labels</strong></span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: white;"></div>
                    <span><strong>Aggregated Values</strong></span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ffe0b2; border-color: #ff9800;"></div>
                    <span><strong>Margins (Totals)</strong></span>
                </div>
            </div>
        </div>

        <!-- Tab 3: Aggregation -->
        <div id="aggregation" class="tab-content">
            <div class="explanation">
                <h3>üìà Aggregation Functions</h3>
                <p>
                    Aggregation functions determine how data is summarized in a pivot table. Different functions
                    answer different questions about your data.
                </p>
            </div>

            <div class="aggregation-visual">
                <div class="agg-box">Values: [10, 20, 30]</div>
                <div class="agg-arrow">‚Üí</div>
                <div class="agg-box" id="aggResult">Result: ?</div>
            </div>

            <div class="controls">
                <button class="btn-primary" onclick="showAggregation('mean')">
                    üìä Mean (Average)
                </button>
                <button class="btn-secondary" onclick="showAggregation('sum')">
                    ‚ûï Sum
                </button>
                <button class="btn-success" onclick="showAggregation('count')">
                    üî¢ Count
                </button>
                <button class="btn-primary" onclick="showAggregation('min')">
                    ‚¨áÔ∏è Min
                </button>
                <button class="btn-secondary" onclick="showAggregation('max')">
                    ‚¨ÜÔ∏è Max
                </button>
                <button class="btn-success" onclick="showAggregation('std')">
                    üìâ Std Dev
                </button>
            </div>

            <div class="output-box" id="aggOutput">
                <h4>üìä Aggregation Details:</h4>
                <pre id="aggText">Click a button above to see how different aggregations work...</pre>
            </div>

            <div class="explanation">
                <h3>üéØ Common Use Cases</h3>
            </div>

            <div class="comparison-grid">
                <div class="comparison-box">
                    <h4 style="color: #667eea;">Mean (Average)</h4>
                    <div class="code-example" style="margin-top: 15px;">
<span class="comment"># Average bill by day</span>
df.<span class="keyword">pivot_table</span>(
    index=<span class="string">'Day'</span>,
    values=<span class="string">'Bill'</span>,
    aggfunc=<span class="string">'mean'</span>
)
                    </div>
                    <p style="margin-top: 10px; color: #666;">
                        <strong>When to use:</strong> Understanding typical values
                    </p>
                </div>

                <div class="comparison-box">
                    <h4 style="color: #667eea;">Sum</h4>
                    <div class="code-example" style="margin-top: 15px;">
<span class="comment"># Total revenue by day</span>
df.<span class="keyword">pivot_table</span>(
    index=<span class="string">'Day'</span>,
    values=<span class="string">'Bill'</span>,
    aggfunc=<span class="string">'sum'</span>
)
                    </div>
                    <p style="margin-top: 10px; color: #666;">
                        <strong>When to use:</strong> Calculating totals or revenue
                    </p>
                </div>

                <div class="comparison-box">
                    <h4 style="color: #667eea;">Count</h4>
                    <div class="code-example" style="margin-top: 15px;">
<span class="comment"># Number of transactions</span>
df.<span class="keyword">pivot_table</span>(
    index=<span class="string">'Day'</span>,
    values=<span class="string">'Bill'</span>,
    aggfunc=<span class="string">'count'</span>
)
                    </div>
                    <p style="margin-top: 10px; color: #666;">
                        <strong>When to use:</strong> Counting occurrences or frequency
                    </p>
                </div>

                <div class="comparison-box">
                    <h4 style="color: #667eea;">Multiple Functions</h4>
                    <div class="code-example" style="margin-top: 15px;">
<span class="comment"># Multiple statistics</span>
df.<span class="keyword">pivot_table</span>(
    index=<span class="string">'Day'</span>,
    values=<span class="string">'Bill'</span>,
    aggfunc=[<span class="string">'mean'</span>, <span class="string">'sum'</span>, <span class="string">'count'</span>]
)
                    </div>
                    <p style="margin-top: 10px; color: #666;">
                        <strong>When to use:</strong> Comprehensive analysis
                    </p>
                </div>
            </div>

            <div class="explanation" style="margin-top: 30px;">
                <h3>üé® Fill Values & Margins</h3>
                <div style="margin-top: 15px;">
                    <p style="margin-bottom: 10px;">
                        <strong>fill_value:</strong> Replace NaN with a specific value (e.g., 0)
                    </p>
                    <div class="code-example">
df.<span class="keyword">pivot_table</span>(index=<span class="string">'Day'</span>, columns=<span class="string">'Smoker'</span>, values=<span class="string">'Bill'</span>, fill_value=<span class="number">0</span>)
                    </div>

                    <p style="margin: 20px 0 10px 0;">
                        <strong>margins:</strong> Add row and column totals (Grand Total)
                    </p>
                    <div class="code-example">
df.<span class="keyword">pivot_table</span>(index=<span class="string">'Day'</span>, columns=<span class="string">'Smoker'</span>, values=<span class="string">'Bill'</span>, margins=<span class="keyword">True</span>)
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 4: Cross-Tabulation -->
        <div id="crosstab" class="tab-content">
            <div class="explanation">
                <h3>‚úñÔ∏è Cross-Tabulation (Crosstab)</h3>
                <p>
                    A <strong>cross-tabulation</strong> is a special pivot table that computes <strong>group frequencies</strong> (counts).
                    It's perfect for answering questions like "How many observations are in each combination of categories?"
                </p>
            </div>

            <div class="comparison-grid">
                <div class="comparison-box">
                    <h4 style="color: #667eea;">Pivot Table (Any Aggregation)</h4>
                    <div class="code-example" style="margin-top: 15px;">
<span class="comment"># Can use any aggfunc</span>
df.<span class="keyword">pivot_table</span>(
    index=<span class="string">'Day'</span>,
    columns=<span class="string">'Smoker'</span>,
    values=<span class="string">'Bill'</span>,
    aggfunc=<span class="string">'mean'</span>  <span class="comment"># or sum, max, etc.</span>
)
                    </div>
                </div>

                <div class="comparison-box">
                    <h4 style="color: #667eea;">Crosstab (Count Only)</h4>
                    <div class="code-example" style="margin-top: 15px;">
<span class="comment"># Automatically counts</span>
pd.<span class="keyword">crosstab</span>(
    index=df[<span class="string">'Day'</span>],
    columns=df[<span class="string">'Smoker'</span>]
)
<span class="comment"># No values needed!</span>
                    </div>
                </div>
            </div>

            <div class="transformation-demo">
                <h4 style="text-align: center; color: #667eea; margin-bottom: 20px;">
                    Cross-Tabulation Example
                </h4>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div>
                        <h5 style="text-align: center; margin-bottom: 10px; color: #666;">
                            Original Data
                        </h5>
                        <table class="small-table">
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <th>Time</th>
                                    <th>Smoker</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td class="index-cell">Fri</td><td class="index-cell">Dinner</td><td class="index-cell">No</td></tr>
                                <tr><td class="index-cell">Fri</td><td class="index-cell">Dinner</td><td class="index-cell">Yes</td></tr>
                                <tr><td class="index-cell">Sat</td><td class="index-cell">Dinner</td><td class="index-cell">No</td></tr>
                                <tr><td class="index-cell">Sat</td><td class="index-cell">Dinner</td><td class="index-cell">No</td></tr>
                                <tr><td class="index-cell">Sun</td><td class="index-cell">Lunch</td><td class="index-cell">Yes</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div>
                        <h5 style="text-align: center; margin-bottom: 10px; color: #666;">
                            Crosstab Result (Counts)
                        </h5>
                        <table class="small-table">
                            <thead>
                                <tr>
                                    <th>Smoker</th>
                                    <th>No</th>
                                    <th>Yes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="index-cell">Fri</td>
                                    <td class="highlight-cell">1</td>
                                    <td class="highlight-cell">1</td>
                                </tr>
                                <tr>
                                    <td class="index-cell">Sat</td>
                                    <td class="highlight-cell">2</td>
                                    <td class="highlight-cell">0</td>
                                </tr>
                                <tr>
                                    <td class="index-cell">Sun</td>
                                    <td class="highlight-cell">0</td>
                                    <td class="highlight-cell">1</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn-primary" onclick="showCrosstabExample('basic')">
                    üìä Basic Crosstab
                </button>
                <button class="btn-secondary" onclick="showCrosstabExample('margins')">
                    ‚ûï With Margins
                </button>
                <button class="btn-success" onclick="showCrosstabExample('normalize')">
                    üìà Normalized (%)
                </button>
            </div>

            <div class="output-box" id="crosstabOutput">
                <h4>üìä Crosstab Example:</h4>
                <pre id="crosstabText">Click a button above to see different crosstab options...</pre>
            </div>

            <div class="explanation">
                <h3>üéØ Crosstab vs Pivot Table</h3>
            </div>

            <div class="comparison-grid">
                <div class="comparison-box">
                    <h4 style="color: #667eea;">Use Crosstab When:</h4>
                    <ul style="line-height: 2; margin: 15px 0 0 20px;">
                        <li>‚úÖ You want to count frequencies</li>
                        <li>‚úÖ Analyzing categorical relationships</li>
                        <li>‚úÖ Creating contingency tables</li>
                        <li>‚úÖ Chi-square test preparation</li>
                    </ul>
                </div>

                <div class="comparison-box">
                    <h4 style="color: #667eea;">Use Pivot Table When:</h4>
                    <ul style="line-height: 2; margin: 15px 0 0 20px;">
                        <li>‚úÖ You need aggregations (mean, sum, etc.)</li>
                        <li>‚úÖ Working with numerical data</li>
                        <li>‚úÖ Multiple aggregation functions</li>
                        <li>‚úÖ More complex summarizations</li>
                    </ul>
                </div>
            </div>

            <div class="code-example">
<span class="comment"># Crosstab with margins (totals)</span>
pd.<span class="keyword">crosstab</span>(
    index=[df[<span class="string">'Time'</span>], df[<span class="string">'Day'</span>]],  <span class="comment"># Multiple index levels</span>
    columns=df[<span class="string">'Smoker'</span>],
    margins=<span class="keyword">True</span>,                      <span class="comment"># Add totals</span>
    margins_name=<span class="string">'Total'</span>               <span class="comment"># Custom name for totals</span>
)

<span class="comment"># Normalized crosstab (percentages)</span>
pd.<span class="keyword">crosstab</span>(
    index=df[<span class="string">'Day'</span>],
    columns=df[<span class="string">'Smoker'</span>],
    normalize=<span class="string">'all'</span>     <span class="comment"># 'all', 'index', or 'columns'</span>
)
            </div>
        </div>

        <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
            <p style="color: #666;">
                <strong>üí° Pro Tip:</strong> Pivot tables are one of the most powerful tools for data analysis.
                They're the bridge between raw data and actionable insights!
            </p>
        </div>
    </div>

    <script>
        // Sample data
        const sampleData = {
            Day: ['Fri', 'Fri', 'Fri', 'Sat', 'Sat', 'Sat', 'Sun', 'Sun', 'Sun', 'Sun'],
            Time: ['Dinner', 'Dinner', 'Lunch', 'Dinner', 'Dinner', 'Lunch', 'Dinner', 'Dinner', 'Lunch', 'Lunch'],
            Smoker: ['No', 'Yes', 'No', 'No', 'Yes', 'No', 'No', 'Yes', 'No', 'Yes'],
            Bill: [20.50, 32.00, 15.75, 25.00, 28.50, 18.00, 30.00, 35.00, 16.50, 22.00],
            Size: [2, 3, 2, 4, 2, 3, 3, 4, 2, 3]
        };

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Pivot Table Builder
        function updatePivotTable() {
            const index = document.getElementById('indexSelect').value;
            const columns = document.getElementById('columnsSelect').value;
            const values = document.getElementById('valuesSelect').value;
            const aggfunc = document.getElementById('aggfuncSelect').value;
            const margins = document.getElementById('marginsCheck').checked;

            // Generate pivot table
            const pivotData = generatePivotTable(index, columns, values, aggfunc, margins);

            // Display table
            const container = document.getElementById('pivotTableContainer');
            container.innerHTML = pivotData.html;

            // Generate code
            const code = `tips.pivot_table(
    index='${index}',
    columns='${columns}',
    values='${values}',
    aggfunc='${aggfunc}'${margins ? ',\n    margins=True' : ''}
)`;

            document.getElementById('builderCode').textContent = code;
        }

        function generatePivotTable(index, columns, values, aggfunc, margins) {
            // Get unique values
            const indexVals = [...new Set(sampleData[index])];
            const columnVals = [...new Set(sampleData[columns])];

            // Create pivot structure
            const pivot = {};

            indexVals.forEach(idx => {
                pivot[idx] = {};
                columnVals.forEach(col => {
                    const filtered = sampleData[values].filter((val, i) =>
                        sampleData[index][i] === idx && sampleData[columns][i] === col
                    );

                    if (filtered.length > 0) {
                        if (aggfunc === 'mean') {
                            pivot[idx][col] = (filtered.reduce((a, b) => a + b, 0) / filtered.length).toFixed(2);
                        } else if (aggfunc === 'sum') {
                            pivot[idx][col] = filtered.reduce((a, b) => a + b, 0).toFixed(2);
                        } else if (aggfunc === 'count') {
                            pivot[idx][col] = filtered.length;
                        } else if (aggfunc === 'min') {
                            pivot[idx][col] = Math.min(...filtered).toFixed(2);
                        } else if (aggfunc === 'max') {
                            pivot[idx][col] = Math.max(...filtered).toFixed(2);
                        }
                    } else {
                        pivot[idx][col] = '-';
                    }
                });
            });

            // Calculate margins if needed
            let marginRow = {};
            let marginCol = {};

            if (margins) {
                // Column totals
                indexVals.forEach(idx => {
                    const allVals = columnVals.map(col => parseFloat(pivot[idx][col])).filter(v => !isNaN(v));
                    if (allVals.length > 0) {
                        if (aggfunc === 'mean') {
                            marginRow[idx] = (allVals.reduce((a, b) => a + b, 0) / allVals.length).toFixed(2);
                        } else if (aggfunc === 'sum' || aggfunc === 'count') {
                            marginRow[idx] = allVals.reduce((a, b) => a + b, 0).toFixed(2);
                        } else if (aggfunc === 'min') {
                            marginRow[idx] = Math.min(...allVals).toFixed(2);
                        } else if (aggfunc === 'max') {
                            marginRow[idx] = Math.max(...allVals).toFixed(2);
                        }
                    }
                });

                // Row totals
                columnVals.forEach(col => {
                    const allVals = indexVals.map(idx => parseFloat(pivot[idx][col])).filter(v => !isNaN(v));
                    if (allVals.length > 0) {
                        if (aggfunc === 'mean') {
                            marginCol[col] = (allVals.reduce((a, b) => a + b, 0) / allVals.length).toFixed(2);
                        } else if (aggfunc === 'sum' || aggfunc === 'count') {
                            marginCol[col] = allVals.reduce((a, b) => a + b, 0).toFixed(2);
                        } else if (aggfunc === 'min') {
                            marginCol[col] = Math.min(...allVals).toFixed(2);
                        } else if (aggfunc === 'max') {
                            marginCol[col] = Math.max(...allVals).toFixed(2);
                        }
                    }
                });
            }

            // Generate HTML
            let html = '<table><thead><tr><th>' + index + ' \\ ' + columns + '</th>';
            columnVals.forEach(col => {
                html += '<th>' + col + '</th>';
            });
            if (margins) html += '<th class="margin-cell">All</th>';
            html += '</tr></thead><tbody>';

            indexVals.forEach(idx => {
                html += '<tr><td class="index-cell">' + idx + '</td>';
                columnVals.forEach(col => {
                    html += '<td class="data-cell">' + pivot[idx][col] + '</td>';
                });
                if (margins) html += '<td class="margin-cell">' + marginRow[idx] + '</td>';
                html += '</tr>';
            });

            if (margins) {
                html += '<tr><td class="margin-cell">All</td>';
                columnVals.forEach(col => {
                    html += '<td class="margin-cell">' + marginCol[col] + '</td>';
                });
                const grandTotal = Object.values(marginCol).filter(v => !isNaN(parseFloat(v)));
                if (aggfunc === 'mean') {
                    html += '<td class="margin-cell">' + (grandTotal.reduce((a, b) => parseFloat(a) + parseFloat(b), 0) / grandTotal.length).toFixed(2) + '</td>';
                } else {
                    html += '<td class="margin-cell">' + (grandTotal.reduce((a, b) => parseFloat(a) + parseFloat(b), 0)).toFixed(2) + '</td>';
                }
                html += '</tr>';
            }

            html += '</tbody></table>';

            return { html };
        }

        // Aggregation demonstrations
        function showAggregation(func) {
            const values = [10, 20, 30];
            let result, explanation;

            switch(func) {
                case 'mean':
                    result = '20.0';
                    explanation = `Mean (Average):
Sum all values and divide by count

Calculation: (10 + 20 + 30) / 3 = 60 / 3 = 20.0

Use case: "What's the average bill amount?"
Best for: Understanding typical values, central tendency`;
                    break;
                case 'sum':
                    result = '60';
                    explanation = `Sum:
Add all values together

Calculation: 10 + 20 + 30 = 60

Use case: "What's the total revenue?"
Best for: Calculating totals, cumulative amounts`;
                    break;
                case 'count':
                    result = '3';
                    explanation = `Count:
Number of observations

Calculation: Count the values = 3

Use case: "How many transactions occurred?"
Best for: Frequency analysis, sample size`;
                    break;
                case 'min':
                    result = '10';
                    explanation = `Minimum:
Smallest value in the group

Calculation: min(10, 20, 30) = 10

Use case: "What's the lowest price?"
Best for: Finding extremes, floor values`;
                    break;
                case 'max':
                    result = '30';
                    explanation = `Maximum:
Largest value in the group

Calculation: max(10, 20, 30) = 30

Use case: "What's the highest bill?"
Best for: Finding extremes, ceiling values`;
                    break;
                case 'std':
                    result = '10.0';
                    explanation = `Standard Deviation:
Measure of spread/variability

Calculation: ‚àö(Œ£(x - mean)¬≤ / n)
           = ‚àö(((10-20)¬≤ + (20-20)¬≤ + (30-20)¬≤) / 3)
           = ‚àö(200 / 3) ‚âà 8.16

Use case: "How much does the data vary?"
Best for: Understanding consistency, variability`;
                    break;
            }

            document.getElementById('aggResult').textContent = `Result: ${result}`;
            document.getElementById('aggResult').classList.add('animate-pulse');
            setTimeout(() => {
                document.getElementById('aggResult').classList.remove('animate-pulse');
            }, 1000);

            document.getElementById('aggText').textContent = explanation;
        }

        // Crosstab demonstrations
        function showCrosstabExample(type) {
            let code, output;

            switch(type) {
                case 'basic':
                    code = `pd.crosstab(index=tips['Day'], columns=tips['Smoker'])`;
                    output = `Smoker   No  Yes
Day
Fri       1    1
Sat       2    1
Sun       2    2

This shows the COUNT of observations for each
combination of Day and Smoker status.

Reading the table:
- Friday had 1 non-smoker and 1 smoker
- Saturday had 2 non-smokers and 1 smoker
- Sunday had 2 non-smokers and 2 smokers`;
                    break;
                case 'margins':
                    code = `pd.crosstab(index=tips['Day'], columns=tips['Smoker'], margins=True)`;
                    output = `Smoker   No  Yes  All
Day
Fri       1    1    2
Sat       2    1    3
Sun       2    2    4
All       5    4    9

The 'All' row and column show totals:
- Total observations on Friday: 2
- Total observations on Saturday: 3
- Total non-smokers: 5
- Total smokers: 4
- Grand total: 9 observations`;
                    break;
                case 'normalize':
                    code = `pd.crosstab(index=tips['Day'], columns=tips['Smoker'], normalize='all')`;
                    output = `Smoker      No    Yes
Day
Fri      0.111  0.111
Sat      0.222  0.111
Sun      0.222  0.222

Shows PERCENTAGES instead of counts (all sum to 1.0)

Reading the table:
- 11.1% of all observations: Friday non-smokers
- 22.2% of all observations: Saturday non-smokers
- 22.2% of all observations: Sunday smokers

Other normalize options:
- 'index': percentages within each row
- 'columns': percentages within each column`;
                    break;
            }

            document.getElementById('crosstabText').textContent = `${code}\n\nResult:\n${output}`;
        }

        // Initialize
        window.onload = function() {
            updatePivotTable();
        };
    </script>
</body>
</html>
